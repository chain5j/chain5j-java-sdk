package com.github.chain5j.core;

import com.github.chain5j.constant.TxType;
import com.github.chain5j.crypto.*;
import com.github.chain5j.engine.SignEngine;
import com.github.chain5j.engine.WalletEngine;
import com.github.chain5j.protocol.Chain5j;
import com.github.chain5j.protocol.core.DefaultBlockParameterName;
import com.github.chain5j.protocol.core.Request;
import com.github.chain5j.protocol.core.methods.request.Transaction;
import com.github.chain5j.protocol.core.methods.response.CallContract;
import com.github.chain5j.protocol.core.methods.response.GetTransactionCount;
import com.github.chain5j.protocol.core.methods.response.SendTransaction;
import com.github.chain5j.protocol.http.HttpService;
import org.junit.Test;

import java.math.BigInteger;

/**
 * @Description:
 * @Author: xwc1125
 * @Date: 2020/6/12 21:51
 * @Copyright Copyright@2020
 */
public class TestEvm {
    /**
     * 部署合约
     */
    @Test
    public void evm() {
        try {
            String privateKey = "7AC46DB941941262187682BF8BCFE75D1739B9E965823176C317A6421A1C2935";
            Sign.SetCryptoName(Crypto.P256);
            Credentials credentials = WalletEngine.loadCredentialsByPrivateKey(privateKey);

            String from = "admin@chain5j.com";

            Chain5j chain5j = Chain5j.build(new HttpService("http://127.0.0.1:9545"));
            Request<?, GetTransactionCount> transactionCount = chain5j.getTransactionCount(from, DefaultBlockParameterName.LATEST);
            BigInteger nonce = transactionCount.send().getTransactionCount();

            BigInteger gasLimit = BigInteger.valueOf(40000000);
            BigInteger gasPrice = BigInteger.valueOf(0);
            BigInteger value = BigInteger.valueOf(0);
            BigInteger deadline = BigInteger.valueOf(0);
            // 合约内容
            String data = "0x608060405234801561001057600080fd5b50613459806100206000396000f300608060405260043610610149576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff16806303bb4b791461014e578063058f170b1461024d57806305db7ae4146102ca5780630e5a5fc0146102fd57806314bb25071461045257806318c27edf146104d75780633d7e22a1146105d65780633ddc17b0146106535780633e13428b146106c65780633e9491a214610719578063417ff82a146107445780634aace71914610843578063794ee56e146108fc578063878066521461097957806391f049ee14610a7857806393b6e17614610bcd578063a4133c6414610d2c578063aee9baf314610d9f578063b1b945eb14610dca578063bf91e99614610ec9578063cc2da9f714611028578063d09c0e98146110b3578063f412f4fd14611212578063f95ce31914611367578063fe4d153614611466575b600080fd5b34801561015a57600080fd5b5061024b600480360381019080803590602001908201803590602001908080601f0160208091040260200160405190810160405280939291908181526020018383808284378201915050505050509192919290803590602001908201803590602001908080601f016020809104026020016040519081016040528093929190818152602001838380828437820191505050505050919291929080359060200190929190803590602001908201803590602001908080601f016020809104026020016040519081016040528093929190818152602001838380828437820191505050505050919291929050505061154f565b005b34801561025957600080fd5b506102b4600480360381019080803590602001908201803590602001908080601f0160208091040260200160405190810160405280939291908181526020018383808284378201915050505050509192919290505050611741565b6040518082815260200191505060405180910390f35b3480156102d657600080fd5b506102df611776565b60405180826000191660001916815260200191505060405180910390f35b34801561030957600080fd5b50610364600480360381019080803590602001908201803590602001908080601f0160208091040260200160405190810160405280939291908181526020018383808284378201915050505050509192919290505050611830565b604051808060200184815260200180602001838103835286818151815260200191508051906020019080838360005b838110156103ae578082015181840152602081019050610393565b50505050905090810190601f1680156103db5780820380516001836020036101000a031916815260200191505b50838103825284818151815260200191508051906020019080838360005b838110156104145780820151818401526020810190506103f9565b50505050905090810190601f1680156104415780820380516001836020036101000a031916815260200191505b509550505050505060405180910390f35b34801561045e57600080fd5b506104b9600480360381019080803590602001908201803590602001908080601f01602080910402602001604051908101604052809392919081815260200183838082843782019150505050505091929192905050506119e4565b60405180826000191660001916815260200191505060405180910390f35b3480156104e357600080fd5b506105d4600480360381019080803590602001908201803590602001908080601f0160208091040260200160405190810160405280939291908181526020018383808284378201915050505050509192919290803590602001908201803590602001908080601f016020809104026020016040519081016040528093929190818152602001838380828437820191505050505050919291929080359060200190929190803590602001908201803590602001908080601f0160208091040260200160405190810160405280939291908181526020018383808284378201915050505050509192919290505050611ad4565b005b3480156105e257600080fd5b5061063d600480360381019080803590602001908201803590602001908080601f0160208091040260200160405190810160405280939291908181526020018383808284378201915050505050509192919290505050611ca4565b6040518082815260200191505060405180910390f35b34801561065f57600080fd5b506106c4600480360381019080803590602001908201803590602001908080601f016020809104026020016040519081016040528093929190818152602001838380828437820191505050505050919291929080359060200190929190505050611cd9565b005b3480156106d257600080fd5b506106f56004803603810190808035600019169060200190929190505050611d8c565b6040518082600581111561070557fe5b60ff16815260200191505060405180910390f35b34801561072557600080fd5b5061072e611dac565b6040518082815260200191505060405180910390f35b34801561075057600080fd5b50610841600480360381019080803590602001908201803590602001908080601f0160208091040260200160405190810160405280939291908181526020018383808284378201915050505050509192919290803590602001908201803590602001908080601f016020809104026020016040519081016040528093929190818152602001838380828437820191505050505050919291929080359060200190929190803590602001908201803590602001908080601f0160208091040260200160405190810160405280939291908181526020018383808284378201915050505050509192919290505050611db2565b005b34801561084f57600080fd5b506108fa600480360381019080803590602001908201803590602001908080601f0160208091040260200160405190810160405280939291908181526020018383808284378201915050505050509192919290803590602001908201803590602001908080601f016020809104026020016040519081016040528093929190818152602001838380828437820191505050505050919291929080359060200190929190505050611f82565b005b34801561090857600080fd5b50610963600480360381019080803590602001908201803590602001908080601f0160208091040260200160405190810160405280939291908181526020018383808284378201915050505050509192919290505050612083565b6040518082815260200191505060405180910390f35b34801561098557600080fd5b50610a76600480360381019080803590602001908201803590602001908080601f0160208091040260200160405190810160405280939291908181526020018383808284378201915050505050509192919290803590602001908201803590602001908080601f016020809104026020016040519081016040528093929190818152602001838380828437820191505050505050919291929080359060200190929190803590602001908201803590602001908080601f01602080910402602001604051908101604052809392919081815260200183838082843782019150505050505091929192905050506120b8565b005b348015610a8457600080fd5b50610adf600480360381019080803590602001908201803590602001908080601f01602080910402602001604051908101604052809392919081815260200183838082843782019150505050505091929192905050506122a3565b604051808060200184815260200180602001838103835286818151815260200191508051906020019080838360005b83811015610b29578082015181840152602081019050610b0e565b50505050905090810190601f168015610b565780820380516001836020036101000a031916815260200191505b50838103825284818151815260200191508051906020019080838360005b83811015610b8f578082015181840152602081019050610b74565b50505050905090810190601f168015610bbc5780820380516001836020036101000a031916815260200191505b509550505050505060405180910390f35b348015610bd957600080fd5b50610c3e600480360381019080803590602001908201803590602001908080601f016020809104026020016040519081016040528093929190818152602001838380828437820191505050505050919291929080359060200190929190505050612457565b604051808060200184815260200180602001838103835286818151815260200191508051906020019080838360005b83811015610c88578082015181840152602081019050610c6d565b50505050905090810190601f168015610cb55780820380516001836020036101000a031916815260200191505b50838103825284818151815260200191508051906020019080838360005b83811015610cee578082015181840152602081019050610cd3565b50505050905090810190601f168015610d1b5780820380516001836020036101000a031916815260200191505b509550505050505060405180910390f35b348015610d3857600080fd5b50610d9d600480360381019080803590602001908201803590602001908080601f01602080910402602001604051908101604052809392919081815260200183838082843782019150505050505091929192908035906020019092919050505061265c565b005b348015610dab57600080fd5b50610db461270f565b6040518082815260200191505060405180910390f35b348015610dd657600080fd5b50610ec7600480360381019080803590602001908201803590602001908080601f0160208091040260200160405190810160405280939291908181526020018383808284378201915050505050509192919290803590602001908201803590602001908080601f016020809104026020016040519081016040528093929190818152602001838380828437820191505050505050919291929080359060200190929190803590602001908201803590602001908080601f0160208091040260200160405190810160405280939291908181526020018383808284378201915050505050509192919290505050612715565b005b348015610ed557600080fd5b50610f3a600480360381019080803590602001908201803590602001908080601f01602080910402602001604051908101604052809392919081815260200183838082843782019150505050505091929192908035906020019092919050505061286c565b604051808060200184815260200180602001838103835286818151815260200191508051906020019080838360005b83811015610f84578082015181840152602081019050610f69565b50505050905090810190601f168015610fb15780820380516001836020036101000a031916815260200191505b50838103825284818151815260200191508051906020019080838360005b83811015610fea578082015181840152602081019050610fcf565b50505050905090810190601f1680156110175780820380516001836020036101000a031916815260200191505b509550505050505060405180910390f35b34801561103457600080fd5b5061108f600480360381019080803590602001908201803590602001908080601f0160208091040260200160405190810160405280939291908181526020018383808284378201915050505050509192919290505050612a71565b6040518082600581111561109f57fe5b60ff16815260200191505060405180910390f35b3480156110bf57600080fd5b50611124600480360381019080803590602001908201803590602001908080601f016020809104026020016040519081016040528093929190818152602001838380828437820191505050505050919291929080359060200190929190505050612ab0565b604051808060200184815260200180602001838103835286818151815260200191508051906020019080838360005b8381101561116e578082015181840152602081019050611153565b50505050905090810190601f16801561119b5780820380516001836020036101000a031916815260200191505b50838103825284818151815260200191508051906020019080838360005b838110156111d45780820151818401526020810190506111b9565b50505050905090810190601f1680156112015780820380516001836020036101000a031916815260200191505b509550505050505060405180910390f35b34801561121e57600080fd5b50611279600480360381019080803590602001908201803590602001908080601f0160208091040260200160405190810160405280939291908181526020018383808284378201915050505050509192919290505050612cb5565b604051808060200184815260200180602001838103835286818151815260200191508051906020019080838360005b838110156112c35780820151818401526020810190506112a8565b50505050905090810190601f1680156112f05780820380516001836020036101000a031916815260200191505b50838103825284818151815260200191508051906020019080838360005b8381101561132957808201518184015260208101905061130e565b50505050905090810190601f1680156113565780820380516001836020036101000a031916815260200191505b509550505050505060405180910390f35b34801561137357600080fd5b50611464600480360381019080803590602001908201803590602001908080601f0160208091040260200160405190810160405280939291908181526020018383808284378201915050505050509192919290803590602001908201803590602001908080601f016020809104026020016040519081016040528093929190818152602001838380828437820191505050505050919291929080359060200190929190803590602001908201803590602001908080601f0160208091040260200160405190810160405280939291908181526020018383808284378201915050505050509192919290505050612e69565b005b34801561147257600080fd5b506114cd600480360381019080803590602001908201803590602001908080601f0160208091040260200160405190810160405280939291908181526020018383808284378201915050505050509192919290505050613009565b6040518080602001838152602001828103825284818151815260200191508051906020019080838360005b838110156115135780820151818401526020810190506114f8565b50505050905090810190601f1680156115405780820380516001836020036101000a031916815260200191505b50935050505060405180910390f35b600061155a846130fc565b151561156557600080fd5b61156e856119e4565b90506002600581111561157d57fe5b60036000836000191660001916815260200190815260200160002060009054906101000a900460ff1660058111156115b157fe5b101515156115be57600080fd5b600160058111156115cb57fe5b60036000836000191660001916815260200190815260200160002060009054906101000a900460ff1660058111156115ff57fe5b1015151561160c57600080fd5b60606040519081016040528085815260200184815260200183815250600660008360001916600019168152602001908152602001600020600082015181600001908051906020019061165f929190613308565b50602082015181600101556040820151816002019080519060200190611686929190613388565b509050506002600581111561169757fe5b60036000836000191660001916815260200190815260200160002060009054906101000a900460ff1660058111156116cb57fe5b141561170e576003806000836000191660001916815260200190815260200160002060006101000a81548160ff0219169083600581111561170857fe5b02179055505b7f5b9bfa32ea2469c7c8a58238bc44e281fc824fae0776ab6a492d99893ae97c6860405160405180910390a15050505050565b60008061174d836119e4565b905060096000826000191660001916815260200190815260200160002080549050915050919050565b600060405160200180806020018281038252600e8152602001807f66756e647320636f6e74726163740000000000000000000000000000000000008152506020019150506040516020818303038152906040526040518082805190602001908083835b6020831015156117fe57805182526020820191506020810190506020830392506117d9565b6001836020036101000a0380198251168184511680821785525050505050509050019150506040518091039020905090565b6060600060606000611841856119e4565b905060066000826000191660001916815260200190815260200160002060000160066000836000191660001916815260200190815260200160002060010154600660008460001916600019168152602001908152602001600020600201828054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156119335780601f1061190857610100808354040283529160200191611933565b820191906000526020600020905b81548152906001019060200180831161191657829003601f168201915b50505050509250808054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156119cf5780601f106119a4576101008083540402835291602001916119cf565b820191906000526020600020905b8154815290600101906020018083116119b257829003601f168201915b50505050509050935093509350509193909250565b6000816040516020018080602001828103825283818151815260200191508051906020019080838360005b83811015611a2a578082015181840152602081019050611a0f565b50505050905090810190601f168015611a575780820380516001836020036101000a031916815260200191505b50925050506040516020818303038152906040526040518082805190602001908083835b602083101515611aa05780518252602082019150602081019050602083039250611a7b565b6001836020036101000a03801982511681845116808217855250505050505090500191505060405180910390209050919050565b6000611adf846130fc565b1515611aea57600080fd5b611af3856119e4565b905060046005811115611b0257fe5b60036000836000191660001916815260200190815260200160002060009054906101000a900460ff166005811115611b3657fe5b10151515611b4357600080fd5b60086000826000191660001916815260200190815260200160002060606040519081016040528086815260200185815260200184815250908060018154018082558091505090600182039060005260206000209060030201600090919290919091506000820151816000019080519060200190611bc1929190613308565b50602082015181600101556040820151816002019080519060200190611be8929190613388565b5050505060046005811115611bf957fe5b60036000836000191660001916815260200190815260200160002060009054906101000a900460ff166005811115611c2d57fe5b1415611c7157600560036000836000191660001916815260200190815260200160002060006101000a81548160ff02191690836005811115611c6b57fe5b02179055505b7fd07da8485bdcafd525495fe3cba5ce63f18d6ff854b9191962c345c1b3812d6560405160405180910390a15050505050565b600080611cb0836119e4565b905060076000826000191660001916815260200190815260200160002080549050915050919050565b60008082111515611ce957600080fd5b611cf2836119e4565b9050611cfd8161313e565b1515611d0857600080fd5b611d39826002600084600019166000191681526020019081526020016000206001015461317390919063ffffffff16565b600260008360001916600019168152602001908152602001600020600101819055507f5148fbfd0391e60a061bc839068a1dc41f687205f967c61bf721d52b7a001bcd60405160405180910390a1505050565b60036020528060005260406000206000915054906101000a900460ff1681565b60005481565b6000611dbd846130fc565b1515611dc857600080fd5b611dd1856119e4565b905060046005811115611de057fe5b60036000836000191660001916815260200190815260200160002060009054906101000a900460ff166005811115611e1457fe5b10151515611e2157600080fd5b60096000826000191660001916815260200190815260200160002060606040519081016040528086815260200185815260200184815250908060018154018082558091505090600182039060005260206000209060030201600090919290919091506000820151816000019080519060200190611e9f929190613308565b50602082015181600101556040820151816002019080519060200190611ec6929190613388565b5050505060046005811115611ed757fe5b60036000836000191660001916815260200190815260200160002060009054906101000a900460ff166005811115611f0b57fe5b1415611f4f57600560036000836000191660001916815260200190815260200160002060006101000a81548160ff02191690836005811115611f4957fe5b02179055505b7f66210437920126860c15ada24e3fadc8932cd9e22d765f81ed78b2f6db87227660405160405180910390a15050505050565b60008082111515611f9257600080fd5b611f9b846119e4565b9050611fa68161313e565b151515611fb257600080fd5b606060405190810160405280848152602001838152602001600115158152506002600083600019166000191681526020019081526020016000206000820151816000019080519060200190612008929190613308565b506020820151816001015560408201518160020160006101000a81548160ff02191690831515021790555090505061204b826000546131bd90919063ffffffff16565b6000819055507ff3de32f92601905147c26807dde5c7bca5f0142c85a343f2447cb28bdc30d6ce60405160405180910390a150505050565b60008061208f836119e4565b905060086000826000191660001916815260200190815260200160002080549050915050919050565b60006120c3846130fc565b15156120ce57600080fd5b6120d7856119e4565b9050600360058111156120e657fe5b60036000836000191660001916815260200190815260200160002060009054906101000a900460ff16600581111561211a57fe5b1015151561212757600080fd5b600760008260001916600019168152602001908152602001600020606060405190810160405280868152602001858152602001848152509080600181540180825580915050906001820390600052602060002090600302016000909192909190915060008201518160000190805190602001906121a5929190613308565b506020820151816001015560408201518160020190805190602001906121cc929190613388565b505050506121e5836001546131bd90919063ffffffff16565b600181905550600360058111156121f857fe5b60036000836000191660001916815260200190815260200160002060009054906101000a900460ff16600581111561222c57fe5b141561227057600460036000836000191660001916815260200190815260200160002060006101000a81548160ff0219169083600581111561226a57fe5b02179055505b7ffded6897f3a633ea9d417ede2a2e73028f083d3ad72a2140ac955fad85bc1f5660405160405180910390a15050505050565b60606000606060006122b4856119e4565b905060056000826000191660001916815260200190815260200160002060000160056000836000191660001916815260200190815260200160002060010154600560008460001916600019168152602001908152602001600020600201828054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156123a65780601f1061237b576101008083540402835291602001916123a6565b820191906000526020600020905b81548152906001019060200180831161238957829003601f168201915b50505050509250808054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156124425780601f1061241757610100808354040283529160200191612442565b820191906000526020600020905b81548152906001019060200180831161242557829003601f168201915b50505050509050935093509350509193909250565b6060600060606000612468866119e4565b90506008600082600019166000191681526020019081526020016000208581548110151561249257fe5b9060005260206000209060030201600001600860008360001916600019168152602001908152602001600020868154811015156124cb57fe5b9060005260206000209060030201600101546008600084600019166000191681526020019081526020016000208781548110151561250557fe5b9060005260206000209060030201600201828054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156125ab5780601f10612580576101008083540402835291602001916125ab565b820191906000526020600020905b81548152906001019060200180831161258e57829003601f168201915b50505050509250808054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156126475780601f1061261c57610100808354040283529160200191612647565b820191906000526020600020905b81548152906001019060200180831161262a57829003601f168201915b50505050509050935093509350509250925092565b6000808211151561266c57600080fd5b612675836119e4565b90506126808161313e565b151561268b57600080fd5b6126bc82600260008460001916600019168152602001908152602001600020600101546131bd90919063ffffffff16565b600260008360001916600019168152602001908152602001600020600101819055507f7420555575dac95b005deef996f98df30e7a69a492d299c93b2d4494685dd3e460405160405180910390a1505050565b60015481565b6000612720846130fc565b151561272b57600080fd5b612734856119e4565b9050606060405190810160405280858152602001848152602001838152506004600083600019166000191681526020019081526020016000206000820151816000019080519060200190612789929190613308565b506020820151816001015560408201518160020190805190602001906127b0929190613388565b50905050600060058111156127c157fe5b60036000836000191660001916815260200190815260200160002060009054906101000a900460ff1660058111156127f557fe5b141561283957600160036000836000191660001916815260200190815260200160002060006101000a81548160ff0219169083600581111561283357fe5b02179055505b7f45f6cf7cecc0a656d9c184e37123258633b3953831ff248786b29585337d93bc60405160405180910390a15050505050565b606060006060600061287d866119e4565b9050600960008260001916600019168152602001908152602001600020858154811015156128a757fe5b9060005260206000209060030201600001600960008360001916600019168152602001908152602001600020868154811015156128e057fe5b9060005260206000209060030201600101546009600084600019166000191681526020019081526020016000208781548110151561291a57fe5b9060005260206000209060030201600201828054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156129c05780601f10612995576101008083540402835291602001916129c0565b820191906000526020600020905b8154815290600101906020018083116129a357829003601f168201915b50505050509250808054600181600116156101000203166002900480601f016020809104026020016040519081016040528092919081815260200182805460018160011615610100020316600290048015612a5c5780601f10612a3157610100808354040283529160200191612a5c565b820191906000526020600020905b815481529060010190602001808311612a3f57829003601f168201915b50505050509050935093509350509250925092565b600080612a7d836119e4565b905060036000826000191660001916815260200190815260200160002060009054906101000a900460ff16915050919050565b6060600060606000612ac1866119e4565b905060076000826000191660001916815260200190815260200160002085815481101515612aeb57fe5b906000526020600020906003020160000160076000836000191660001916815260200190815260200160002086815481101515612b2457fe5b90600052602060002090600302016001015460076000846000191660001916815260200190815260200160002087815481101515612b5e57fe5b9060005260206000209060030201600201828054600181600116156101000203166002900480601f016020809104026020016040519081016040528092919081815260200182805460018160011615610100020316600290048015612c045780601f10612bd957610100808354040283529160200191612c04565b820191906000526020600020905b815481529060010190602001808311612be757829003601f168201915b50505050509250808054600181600116156101000203166002900480601f016020809104026020016040519081016040528092919081815260200182805460018160011615610100020316600290048015612ca05780601f10612c7557610100808354040283529160200191612ca0565b820191906000526020600020905b815481529060010190602001808311612c8357829003601f168201915b50505050509050935093509350509250925092565b6060600060606000612cc6856119e4565b905060046000826000191660001916815260200190815260200160002060000160046000836000191660001916815260200190815260200160002060010154600460008460001916600019168152602001908152602001600020600201828054600181600116156101000203166002900480601f016020809104026020016040519081016040528092919081815260200182805460018160011615610100020316600290048015612db85780601f10612d8d57610100808354040283529160200191612db8565b820191906000526020600020905b815481529060010190602001808311612d9b57829003601f168201915b50505050509250808054600181600116156101000203166002900480601f016020809104026020016040519081016040528092919081815260200182805460018160011615610100020316600290048015612e545780601f10612e2957610100808354040283529160200191612e54565b820191906000526020600020905b815481529060010190602001808311612e3757829003601f168201915b50505050509050935093509350509193909250565b6000612e74846130fc565b1515612e7f57600080fd5b612e88856119e4565b9050606060405190810160405280858152602001848152602001838152506005600083600019166000191681526020019081526020016000206000820151816000019080519060200190612edd929190613308565b50602082015181600101556040820151816002019080519060200190612f04929190613388565b5090505060016005811115612f1557fe5b60036000836000191660001916815260200190815260200160002060009054906101000a900460ff166005811115612f4957fe5b1480612f93575060006005811115612f5d57fe5b60036000836000191660001916815260200190815260200160002060009054906101000a900460ff166005811115612f9157fe5b145b15612fd657600260036000836000191660001916815260200190815260200160002060006101000a81548160ff02191690836005811115612fd057fe5b02179055505b7f60bb19656e35e200e567a74b581d569e728418357b2e5d960ad5d624a5a6600c60405160405180910390a15050505050565b6060600080613017846119e4565b905060026000826000191660001916815260200190815260200160002060000160026000836000191660001916815260200190815260200160002060010154818054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156130eb5780601f106130c0576101008083540402835291602001916130eb565b820191906000526020600020905b8154815290600101906020018083116130ce57829003601f168201915b505050505091509250925050915091565b600080613108836119e4565b905060026000826000191660001916815260200190815260200160002060020160009054906101000a900460ff16915050919050565b600060026000836000191660001916815260200190815260200160002060020160009054906101000a900460ff169050919050565b60006131b583836040805190810160405280601e81526020017f536166654d6174683a207375627472616374696f6e206f766572666c6f770000815250613247565b905092915050565b600080828401905083811015151561323d576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040180806020018281038252601b8152602001807f536166654d6174683a206164646974696f6e206f766572666c6f77000000000081525060200191505060405180910390fd5b8091505092915050565b60008084841115839015156132f7576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825283818151815260200191508051906020019080838360005b838110156132bc5780820151818401526020810190506132a1565b50505050905090810190601f1680156132e95780820380516001836020036101000a031916815260200191505b509250505060405180910390fd5b508385039050809150509392505050565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f1061334957805160ff1916838001178555613377565b82800160010185558215613377579182015b8281111561337657825182559160200191906001019061335b565b5b5090506133849190613408565b5090565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f106133c957805160ff19168380011785556133f7565b828001600101855582156133f7579182015b828111156133f65782518255916020019190600101906133db565b5b5090506134049190613408565b5090565b61342a91905b8082111561342657600081600090555060010161340e565b5090565b905600a165627a7a72305820c8b791f0345c46f217709d5d04ed5d525b6c06508f3fc154845f94373cb30e400029";
            String extra = "";
            RawTransaction transaction = RawTransaction.createEvmTransaction(from, nonce, gasLimit, gasPrice,
                    value, data, deadline, extra);
            String rawTx = SignEngine.sign(transaction, credentials);
            System.out.println("rawTx="+rawTx);

            Request<?, SendTransaction> sendRawTransaction = chain5j.sendRawTransaction(TxType.STATE, rawTx);
            String hash = sendRawTransaction.send().getTransactionHash();
            System.out.println("hash="+hash);
        } catch (Exception e) {
            e.printStackTrace();
        }
    }


    @Test
    public void sendContractTx() {
        try {
            String privateKey = "7AC46DB941941262187682BF8BCFE75D1739B9E965823176C317A6421A1C2935";
            Sign.SetCryptoName(Crypto.P256);
            Credentials credentials = WalletEngine.loadCredentialsByPrivateKey(privateKey);

            String from = "admin@chain5j.com";
            String contractAddress = "0x06a6f320fc12c9b633457ab50cdfcb4149baa2a4@chain5j.contract";

            Chain5j chain5j = Chain5j.build(new HttpService("http://127.0.0.1:9545"));
            Request<?, GetTransactionCount> transactionCount = chain5j.getTransactionCount(from, DefaultBlockParameterName.LATEST);
            BigInteger nonce = transactionCount.send().getTransactionCount();
            nonce=BigInteger.valueOf(6);

            BigInteger gasLimit = BigInteger.valueOf(4700000);
            BigInteger gasPrice = BigInteger.valueOf(0);
            BigInteger value = new BigInteger("0");
            BigInteger deadline = BigInteger.valueOf(0);
            // 合约内容
            String data = "0x4aace719000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000027100000000000000000000000000000000000000000000000000000000000000001310000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000013100000000000000000000000000000000000000000000000000000000000000";
            String extra = "0x02";
            RawTransaction transaction = new RawTransaction(from, contractAddress, Interpreter.EVM, nonce, gasLimit, gasPrice,
                    value, data, deadline, extra);
            String rawTx = SignEngine.sign(transaction, credentials);
            System.out.println("rawTx="+rawTx);

            Request<?, SendTransaction> sendRawTransaction = chain5j.sendRawTransaction(TxType.STATE, rawTx);
            String hash = sendRawTransaction.send().getTransactionHash();
            System.out.println("hash="+hash);
        } catch (Exception e) {
            e.printStackTrace();
        }
    }

    @Test
    public void callContract() {
        try {
            Chain5j chain5j = Chain5j.build(new HttpService("http://127.0.0.1:9545"));
            String from = "admin@chain5j.com";

            String contractAddress = "0xEE392C81d0d74933Bb0982cb007082B4b23fd9F1";
            String contractAccount = contractAddress + "@chain5j.contract";

//            Address addressA = new Address(address);
//            Function function = new Function("balanceOf", Arrays.<Type>asList(addressA), Collections.<TypeReference<?>>emptyList());

            // from,to 合约调用时，必须是16进制的
            Transaction callTransaction = SignEngine.getCallTransaction(from, contractAccount, "");
            Request<?, CallContract> callContractRequest = chain5j.callContract(callTransaction, DefaultBlockParameterName.LATEST);
            String s = callContractRequest.send().getValue();
            System.out.println(s);
        } catch (Exception e) {
            e.printStackTrace();
        }
    }

    @Test
    public void getTokenBalance() {
        try {
            Chain5j chain5j = Chain5j.build(new HttpService("http://127.0.0.1:9545"));
            String from = "admin@chain5j.com";

            String contractAddress = "0xEE392C81d0d74933Bb0982cb007082B4b23fd9F1";
            String contractAccount = contractAddress + "@chain5j.contract";
            // 合约调用时，必须是16进制的
            BigInteger bigInteger = SignEngine.getTokenBalance(chain5j, TxType.STATE, from, contractAccount);
            System.out.println(bigInteger);
        } catch (Exception e) {
            e.printStackTrace();
        }
    }
}
